<!doctype html>
<html ng-app="statistika">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="components/normalize.css">
    <link rel="stylesheet" href="components/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="components/bootstrap/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="statistika.css">

    <script>
        var _errs=["518581baec196dbf56000431"];(function(a,b){a.onerror=function(){_errs.push(arguments)};
        var d=function(){var a=b.createElement("script"),c=b.getElementsByTagName("script")[0];
        a.src="//d15qhc0lu1ghnk.cloudfront.net/beacon.js";a.async=!0;
        c.parentNode.insertBefore(a,c)};a.addEventListener?a.addEventListener("load",d,!1):
        a.attachEvent("onload",d)})(window,document);
    </script>

    <script src="components/jquery/jquery-1.9.1.min.js"></script>
    <script src="components/angular/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
    <script src="components/angular-ui/sortable.js"></script>
    <script src="components/angular-ui/if.js"></script>
    <script src="components/persist-min.js"></script>
    <script src="components/underscore-min.js"></script>
    <script src="statistika.js" charset="utf-8"></script>
  </head>

  <body ng-controller="MainCtrl">
    <div id="reset-persisted-data">
      <button ng-click="reset()">vymazat data</button>
    </div>

    <div class="container">
      <section ng-controller="VariablesCtrl" class="row">
        <h1>Formulace statistického šetření</h1>
        <h2>Statistické znaky</h2>

        <fieldset class="span4" ng-repeat="variable in header.variables">
          <h3 class="variable"><input type="text" ng-model="variable.name" ng-required="true"></h3>
          <label>
            <textarea ng-model="variable.description"
                      placeholder="Description of your variable"></textarea>
          </label>
          <label>
            <select ng-model="variable.scale" ng-options="scale.key as scale.description for scale in scales">
              <option value=""></option>
            </select>
          </label>

          <h3>Skupiny <button ng-show="canAddGroup(variable)" ng-click="addGroup(variable)">&plus;</button></h3>

          <div ng-switch="variable.scale">
            <ul ng-switch-when="nominal">

            </ul>
            <ol ng-switch-when="ordinal" ui-sortable="ordinalOptions($index)">
              <li ng-repeat="group in variable.ordinal($index, rows)">
                {{ group }}
              </li>
            </ol>
            <ul ng-switch-when="quantitative">...</ul>
            <ul ng-switch-when="absolute" >
              <li ng-repeat="group in variable.groups">
                <!-- TODO: proper form validation -->
                <form>
                  <input type="number" name="min" ng-model="group.min" ng-required="true">
                  <input type="number" name="max" ng-model="group.max" ng-required="true">
                  <button ng-click="removeGroup(variable, group)">&minus;</button>
                  <!-- refactor this massive condition -->
                  <p class="error" ui-if="group.min && group.max && group.min >= group.max">
                    minimum ({{group.min}}) musí být menší než maximum ({{group.max}})
                  </p>
                  <p class="error" ui-if="variable.groups[$index + 1] && group.max != variable.groups[$index + 1].min">
                    nenavazuje na dalsi skupinu ({{ group.max }} != {{ variable.groups[$index + 1].min }})
                  </p>
                </form>
              </li>
            </ul>
          </div>
        </fieldset>
      </section>

      <section ng-controller="DataCtrl" class="row">
        <h1>Data</h1>
        <table id="data">
          <thead>
            <tr>
              <td/>
              <td ng-click="orderBy(variable)" ng-repeat="variable in header.variables" class="sortable" ng-class="variable.order">
                {{ variable.name }}
              </td>
              <td>
                <button ng-click="addRow()" title="add row">&plus; řádek</button>
              </td>
            </tr>
          </thead>

          <tfoot>
            <tr>
              <td/>
              <td ng-repeat="column in header.columns">{{column.value}}</td>
            </tr>
          </tfoot>

          <tbody ui-sortable="sortableOptions">
            <tr ng-repeat="row in rows">
              <td><i class="icon-reorder"></i></td>
              <td ng-repeat="column in row.columns">
                <input type="text" ng-model="column.value">
              </td>
              <td>
                <button ng-click="removeRow(row)" title="remove row" tabindex="-1">&minus;</button>
              </td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>
  </body>
</html>
