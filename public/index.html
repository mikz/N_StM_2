<!doctype html>
<html ng-app="statistika">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="components/normalize.css">
    <link rel="stylesheet" href="components/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="components/bootstrap/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="statistika.css">

    <script>
        var _errs=["518581baec196dbf56000431"];(function(a,b){a.onerror=function(){_errs.push(arguments)};
        var d=function(){var a=b.createElement("script"),c=b.getElementsByTagName("script")[0];
        a.src="//d15qhc0lu1ghnk.cloudfront.net/beacon.js";a.async=!0;
        c.parentNode.insertBefore(a,c)};a.addEventListener?a.addEventListener("load",d,!1):
        a.attachEvent("onload",d)})(window,document);
    </script>

    <script src="components/jquery/jquery-1.9.1.min.js"></script>
    <script src="components/angular/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
    <script src="components/angular-ui/sortable.js"></script>
    <script src="components/angular-ui/if.js"></script>
    <script src="components/persist-min.js"></script>
    <script src="components/underscore-min.js"></script>
    <script src="components/rationaljs.alpha.js"></script>
    <script src="statistika.js" charset="utf-8"></script>

    <script async src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=AM_HTMLorMML"></script>
  </head>

  <body ng-controller="MainCtrl">
    <div id="reset-persisted-data">
      <button ng-click="reset()">vymazat data</button>
    </div>

    <div class="container">
      <section class="row">
        <h1>Formulace statistického šetření</h1>
        <h2>Statistické znaky</h2>

        <fieldset class="span4" ng-repeat="variable in header.variables" ng-controller="VariableCtrl">
          <h3 class="variable"><input type="text" ng-model="variable.name" ng-required="true"></h3>
          <label>
            <textarea ng-model="variable.description"
                      placeholder="Description of your variable"></textarea>
          </label>
          <label>
            <select ng-model="variable.scale" ng-options="scale.key as scale.description for scale in scales">
              <option value=""></option>
            </select>
          </label>

          <h3>Skupiny <button ng-show="canAddGroup()" ng-click="addGroup()">&plus;</button></h3>

          <div ng-switch="variable.scale">

            <ul ng-switch-when="nominal">
              <li ng-repeat="group in groups">
                {{ group }}
              </li>
            </ul>

            <ol ng-switch-when="ordinal" ui-sortable="ordinalOptions()">
              <li class="icon-reorder" ng-repeat="group in groups">
                {{ group }}
              </li>
            </ol>

            <ol ng-switch-default>
              <li ng-repeat="group in groups">
                <!-- TODO: proper form validation -->
                <form>
                  <input type="number" name="min" ng-model="group.min" ng-required="true">
                  <input type="number" name="max" ng-model="group.max" ng-required="true">
                  <button ng-click="removeGroup(group)">&minus;</button>
                  <!-- refactor this massive condition -->
                  <p class="error" ui-if="group.min && group.max && group.min >= group.max">
                    minimum ({{group.min}}) musí být menší než maximum ({{group.max}})
                  </p>
                  <p class="error" ui-if="variable.groups[$index + 1] && group.max != variable.groups[$index + 1].min">
                    nenavazuje na dalsi skupinu ({{ group.max }} != {{ variable.groups[$index + 1].min }})
                  </p>
                </form>
              </li>
            </ol>
          </div>
        </fieldset>
      </section>

      <section ng-controller="DataCtrl" class="row">
        <h1>Data</h1>
        <table id="data">
          <thead>
            <tr>
              <td/>
              <td ng-click="orderBy(variable)" ng-repeat="variable in header.variables" class="sortable" ng-class="variable.sort">
                {{ variable.name }}
              </td>
              <td>
                <button ng-click="addRow()" title="add row">&plus; řádek</button>
              </td>
            </tr>
          </thead>

          <tfoot>
            <tr>
              <td/>
              <td ng-repeat="column in header.columns">{{column.value}}</td>
            </tr>
          </tfoot>

          <tbody ui-sortable="sortableOptions">
            <tr ng-repeat="row in rows">
              <td><i class="icon-reorder"></i></td>
              <td ng-repeat="column in row.columns">
                <input type="text" ng-model="column.value">
              </td>
              <td>
                <button ng-show="rows.length > 1" ng-click="removeRow(row)" title="remove row" tabindex="-1">&minus;</button>
              </td>
            </tr>
          </tbody>
        </table>
      </section>

      <section class="row" ng-repeat="variable in variables">
        <h1>Tabulka {{ variable.name }}</h1>
        <table class="table" ng-controller="TableCtrl">
          <thead>
            <tr>
              <th>škála</th>
              <th>absolutní četnosti</th>
              <th>relativní četnosti</th>
              <th>kumulativní četnosti</th>
              <th>obecný moment 1. řádu</th>
              <th>obecný moment 2. řádu</th>
              <th>obecný moment 3. řádu</th>
              <th>obecný moment 4. řádu</th>
            </tr>
            <tr>
              <th>`x_i`</th>
              <th>`n_i`</th>
              <th>`n_i/n`</th>
              <th>`sum n_i/n`</th>
              <th>`x_i*n_i`</th>
              <th>`x_i^2*n_i`</th>
              <th>`x_i^3*n_i`</th>
              <th>`x_i^4*n_i`</th>
            </tr>

          </thead>
          <tbody>
            <tr ng-repeat="element in elements">
              <td>{{ $index  + 1}}</td>
              <td>{{ element.absolute | decimal}}</td>
              <td>{{ element.relative | decimal }}</td>

              <td>{{ element.cumulative | decimal }}</td>
              <td>{{ element.moment(1) | decimal }}</td>
              <td>{{ element.moment(2) | decimal }}</td>
              <td>{{ element.moment(3) | decimal }}</td>
              <td>{{ element.moment(4) | decimal }}</td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>
  </body>
</html>
